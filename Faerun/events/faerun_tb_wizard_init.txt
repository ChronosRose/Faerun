namespace = wizinit

character_event = {
	id = wizinit.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		z_wizard = yes
		OR = {
			is_save_game = no
			NOT = { has_character_flag = wizspellinit }
		}
	}
	
	immediate = {
		set_character_flag = wizspellinit
		set_variable = { which = wizspellpoints value = 0 }
		export_to_variable = {
			which = wizspellpoints
			value = learning
		}
		trigger_switch = {
			on_trigger = trait
			wizard = {
				change_variable = { which = wizspellpoints value = 1 }
			}
			trained_wizard = {
				change_variable = { which = wizspellpoints value = 2 }
			}
			journeyman_wizard = {
				change_variable = { which = wizspellpoints value = 4 }
			}
			expert_wizard = {
				change_variable = { which = wizspellpoints value = 7 }
			}
			master_wizard = {
				change_variable = { which = wizspellpoints value = 10 }
			}
			legendary_wizard = {
				change_variable = { which = wizspellpoints value = 15 }
			}
		}
		add_character_modifier = {
			name = wiz_spellpoint_mod
			duration = -1
		}
		character_event = { id = wizinit.2 years = 1 }
	}
}

character_event = {
	id = wizinit.2
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = { # This is to catch the extremely rare cases of someone ceasing to be a wizard
			limit = {
				z_wizard = no
			}
			remove_character_modifier = spellpoint_mod
			break = yes
		}
		# Resets the variable
		set_variable = { which = wizspellpoints value = 0 }
		export_to_variable = {
			which = wizspellpoints
			value = learning
		}
		trigger_switch = {
			on_trigger = trait
			wizard = {
				change_variable = { which = wizspellpoints value = 1 }
			}
			trained_wizard = {
				change_variable = { which = wizspellpoints value = 2 }
			}
			journeyman_wizard = {
				change_variable = { which = wizspellpoints value = 4 }
			}
			expert_wizard = {
				change_variable = { which = wizspellpoints value = 7 }
			}
			master_wizard = {
				change_variable = { which = wizspellpoints value = 10 }
			}
			legendary_wizard = {
				change_variable = { which = wizspellpoints value = 15 }
			}
		}
		character_event = { id = wizinit.2 years = 1 }
	}
}

character_event = {
	id = wizinit.3
	desc = WIZSPECDESC
	picture = GFX_evt_wizard
	
	is_triggered_only = yes
	
	trigger = {
		z_wizard = yes
		OR = {
			is_save_game = no
			NOT = { has_character_flag = wizspellinit3 }
		}
	}

	immediate = {
		set_character_flag = wizspellinit3
	}
	
	option = {
		name = WIZSPEC1
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_abjuration
				duration = -1
			}
		}
	}
	option = {
		name = WIZSPEC2
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_transmutation
				duration = -1
			}
		}
	}
	option = {
		name = WIZSPEC3
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_conjuration
				duration = -1
			}
		}
	}
	option = {
		trigger = {
			ai = no
		}
		name = TB_OPT_MORE
		character_event = { id = wizinit.4 }
	}
	option = {
		trigger = {
			ai = yes
		}
		name = OK
		add_character_modifier = {
			name = wiz_divination
			duration = -1
		}
	}
	option = {
		trigger = {
			ai = yes
		}
		name = OK
		add_character_modifier = {
			name = wiz_enchantment
			duration = -1
		}
	}
	option = {
		trigger = {
			ai = yes
		}
		name = OK
		add_character_modifier = {
			name = wiz_evocation
			duration = -1
		}
	}
	option = {
		trigger = {
			ai = yes
		}
		name = OK
		add_character_modifier = {
			name = wiz_illusion
			duration = -1
		}
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1000
				OR = {
					trait = undead
					trait = lich
					trait = vampire
					trait = vampire_spawn
				}
			}
		}
		trigger = {
			ai = yes
		}
		name = OK
		add_character_modifier = {
			name = wiz_necromancy
			duration = -1
		}
	}
	option = {
		trigger = {
			ai = yes
			year = 1359
		}
		name = OK
		add_character_modifier = {
			name = wiz_wild
			duration = -1
		}
	}
}
character_event = {
	id = wizinit.4
	desc = WIZSPECDESC
	picture = GFX_evt_wizard
	
	is_triggered_only = yes
	
	option = {
		name = WIZSPEC4
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_divination
				duration = -1
			}
		}
	}
	option = {
		name = WIZSPEC5
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_enchantment
				duration = -1
			}
		}
	}
	option = {
		name = WIZSPEC6
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_evocation
				duration = -1
			}
		}
	}
	option = {
		name = TB_OPT_MORE
		character_event = { id = wizinit.5 }
	}
}

character_event = {
	id = wizinit.5
	desc = WIZSPECDESC
	picture = GFX_evt_wizard
	
	is_triggered_only = yes
	
	option = {
		name = WIZSPEC7
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_illusion
				duration = -1
			}
		}
	}
	option = {
		name = WIZSPEC8
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_necromancy
				duration = -1
			}
		}
	}
	option = {
		trigger = {
			year = 1359
		}
		name = WIZSPEC9
		hidden_tooltip = {
			add_character_modifier = {
				name = wiz_wild
				duration = -1
			}
		}
	}
	option = {
		name = TB_OPT_BACK
		character_event = { id = wizinit.3 }
	}
}