#Small explanation as for how wizard spellcasting works: wizards have a number of spell-slots, level dependent. Each spell costs one slot of the same category

decisions = {

#Universal spells
	
	dispel = {
		ai_check_interval = 30
		potential = {
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HASBADSPELL
				hidden_tooltip = {
					has_bad_spell_effect = yes
				}
			}
			custom_tooltip = {
				text = HAS10SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 10 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_dispel_cooldown }
						had_character_flag = { flag = spell_dispel_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } }
			set_character_flag = spell_dispel_cooldown
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			dispel_minor_magic = yes
		}
		ai_will_do = {
			factor = 0.1
		}
	}
	
	disrupt_undead = {
		ai_check_interval = 5
		potential = {
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS15SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 15 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_disrupt_undead_cooldown }
						had_character_flag = { flag = spell_disrupt_undead_cooldown months = 1 }
					}
				}
			}
			in_battle = yes
			combat = {
				enemy = {
					OR = {
						trait = undead
						trait = lich
						trait = lich_baelnorn
						trait = vampire
						trait = vampire_spawn
						any_controlled_unit = {
							troops = {
								who = undead_troops
								value > 0
							}
						}
					}
				}
			}
		}
		effect = {
			change_variable = { which = wizspellpoints value = -15 }
			set_character_flag = spell_disrupt_undead_cooldown
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			if = {
				limit = {
					combat = {
						enemy = {
							any_controlled_unit = {
								troops = {
									who = undead_troops
									value > 0
								}
							}
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							#limit = {
							#	troops = {
							#		who = undead_troops
							#		value > 0
							#	}
							#}
							damage_unit = {
								type = undead_troops
								percentage = 33
							}
							random = {
								chance = 33
								damage_unit = {
									type = undead_troops
									percentage = 33
								}
							}
							random = {
								chance = 33
								damage_unit = {
									type = undead_troops
									percentage = 33
								}
							}
						}
					}
				}
			}
			if = {
				limit = {
					combat = {
						enemy = {
							ai = no
						}
					}
				}
				combat = {
					enemy = {
						repeat_event = { id = spellaux.3 }
					}
				}
			}
			combat = {
				enemy = {
					spell_resistance_check = yes
					if = {
						limit = {
							NOT = { has_character_modifier = disrupt_undead_mod }
						}
						add_character_modifier = {
							name = disrupt_undead_mod
							months = 2
						}
						opinion = {
							modifier = cast_spell_on_me
							who = ROOT
							years = 1
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	
	spell_banish_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_longevity = {
		ai_check_interval = 50
		potential = {
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			NOT = { has_character_modifier = wiz_necromancy }
			NOR = {
				trait = creature_drow
				trait = creature_elf
				trait = creature_feyri
				trait = creature_eladrin
				trait = creature_treant
				trait = undead
				trait = lich
				trait = vampire
				trait = vampire_spawn
				trait = lich_baelnorn
				trait = creature_sarrukh
				trait = creature_naga
				trait = creature_monster
				trait = creature_beholder
				trait = creature_devil
				trait = creature_daemon
				trait = creature_demon
				trait = creature_angel
				trait = creature_genie
				trait = longevity
			}
		}
		
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			scaled_wealth = { value = 0.2 min = 100 }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS30SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 30 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_longevity_cooldown }
						had_character_flag = { flag = spell_longevity_cooldown months = 1 }
					}
				}
			}
		}
		
		effect = {
			scaled_wealth = { value = -0.2 min = 100 }
			set_character_flag = spell_longevity_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -30 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			random = {
				chance = 75
				add_trait = longevity
			}
		}
		ai_will_do = {
			factor = 0.6
		}
	}

# Abjuration spells
	
	alustriels_mantle = {
		ai_check_interval = 4
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_alustriels_mantle
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { trait = alustriels_mantle_trait }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_alustriels_mantle_cooldown }
						had_character_flag = { flag = spell_alustriels_mantle_cooldown months = 1 }
					}
				}
			}
			in_battle = yes
		}
		effect = {
			set_character_flag = spell_alustriels_mantle_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait = alustriels_mantle_trait
			character_event = { id = spellaux.6 months = 1 }
		}
		ai_will_do = {
			factor = 0.7
		}
	}
	
	nezrams_amethyst_aura = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_nezrams_amethyst_aura
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = nezrams_amethyst_aura_mod }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_nezrams_amethyst_aura_cooldown }
						had_character_flag = { flag = spell_nezrams_amethyst_aura_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_nezrams_amethyst_aura_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = nezrams_amethyst_aura_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.4
			modifier = {
				factor = 0.1
				health = 10 # Don't really need it
			}
			modifier = {
				factor = 5
				NOT = { health = 5 }
			}
		}
	}
	
	spell_remove_disease_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_remove_disease
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_mantle = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_spell_mantle
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = spell_mantle_mod }
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS10SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 10 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_mantle_cooldown }
						had_character_flag = { flag = spell_mantle_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_mantle_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = spell_mantle_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 10
				in_battle = yes
				enemy = {
					OR = {
						z_wizard = yes
						z_sorcerer = yes
						z_warlock = yes
						z_paladin = yes
						z_ranger = yes
						z_cleric = yes
						z_bard = yes
					}
				}
			}
		}
	}
	
	planar_binding = {
		ai_check_interval = 24
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_planar_binding
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS20SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 20 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_planar_binding_cooldown }
						had_character_flag = { flag = spell_planar_binding_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_planar_binding_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			custom_tooltip = {
				text = OUTSIDERSUMMONED
				hidden_tooltip = {
					random_list = {
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_angel
								random_traits = yes
								religion = good_human_pantheon
								culture = angel
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 300
								female = random
								trait = creature_genie
								random_traits = yes
								religion = ten_thousand_gods
								culture = jann
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_devil
								random_traits = yes
								religion = infernal
								culture = baatezu
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_demon
								random_traits = yes
								religion = abyssal_cult
								culture = tanarri
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_daemon
								random_traits = yes
								religion = evil_human_pantheon
								culture = yugoloth
								dynasty = none
								immortal_age = 30
							}
						}
					}
					new_character = {
						opinion = {
							modifier = planar_binding_mod
							who = ROOT
							years = 2000
						}
						if = {
							limit = {
								trait = creature_devil
							}
							random_list = {
								65 = {
									set_graphical_culture = cornugon
								}
								20 = {
									add_trait = greater_fiend
								}
								10 = {
									set_graphical_culture = gelugon
									add_trait = greater_fiend
								}
								5 = {
									set_graphical_culture = tiefling
								}
							}
						}
						else_if = {
							limit = {
								trait = creature_demon
							}
							random_list = {
								65 = {
									# do nothing - vrock gfx is correct
								}
								20 = {
									set_graphical_culture = succubus
								}
								10 = {
									set_graphical_culture = nalfeshnee
									add_trait = greater_fiend
								}
								10 = {
									set_graphical_culture = succubus
									add_trait = greater_fiend # marilith
								}						
								2 = {
									set_graphical_culture = baatezu # balors look a lot like pit fiends
									add_trait = greater_fiend
								}
								2 = {
									set_graphical_culture = yugoloth # or nycaloths
									add_trait = greater_fiend
								}
								2 = {
									set_graphical_culture = cambion
								}
							}
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.2
			modifier = {
				factor = 0
				has_full_court = yes
			}
		}
	}
	
	burn_path_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_burn_path
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}

#Transmutation spells

	spell_slow_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_slow
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_longstrider = {
		ai_check_interval = 6
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_longstrider
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_command = yes
			NOT = { trait = spell_longstrider_trait }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_longstrider_cooldown }
						had_character_flag = { flag = spell_longstrider_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_longstrider_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait = spell_longstrider_trait
			hidden_tooltip = { character_event = { id = spellaux.15 months = 2 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_fabricate_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_fabricate
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_create_homunculus = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_create_homunculus
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_artifact = homunculus_artf }
			NOT = { has_injury_trigger = yes }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS13SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 13 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_homunculus_cooldown }
						had_character_flag = { flag = spell_homunculus_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_create_homunculus_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -13 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait_wounded_effect = yes
			add_artifact = homunculus_artf
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	tensers_transformation = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_tensers_transformation
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			hidden_tooltip = {
				OR = {
					ai = no
					AND = {
						has_character_flag = is_in_duel
						NOT = { had_character_flag = { flag = is_in_duel months = 1 } }
					}
				}
			}
		}
		allow = {
			NOT = { has_character_modifier = tensers_transformation_mod }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS15SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 15 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_tensers_transformation_cooldown }
						had_character_flag = { flag = spell_tensers_transformation_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_tensers_transformation_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = tensers_transformation_mod
				months = 1
			}
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				trait = slothful
			}
			modifier = {
				factor = 0.5
				trait = proud
			}
		}
	}
	
	spell_disintegrate_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_disintegration
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}

#Conjuration spells

	mordekainens_faithful_hound = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_flag = knows_spell_mordekainens_faithful_hound
			}
			OR = {
				AND = {
					ai = yes
					OR = {
						has_job_title = job_spymaster
						is_ruler = yes
					}
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = mordekainens_faithful_hound_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_mordekainens_faithful_hound_cooldown }
						had_character_flag = { flag = spell_mordekainens_faithful_hound_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_mordekainens_faithful_hound_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = mordekainens_faithful_hound_mod
				months = 2
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 0.5
				intrigue = 15 # Don't really need it
			}
			modifier = {
				factor = 2
				NOT = { intrigue = 5 }
			}
		}
	}
	
	spell_find_familiar = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_flag = knows_spell_find_familiar
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_artifact = wiz_familiar_artf }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_find_familiar_cooldown }
						had_character_flag = { flag = spell_find_familiar_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_find_familiar_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_artifact = wiz_familiar_artf
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}

	spell_summon_lesser_demons = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_flag = knows_spell_summon_lesser_demons
			}
			OR = {
				AND = {
					ai = yes
					is_ruler = yes
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			war = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = NOSUMMONEDDEMONS
				hidden_tooltip = {
					NOT = { has_earmarked_regiments = wiz_lesser_demons }
				}
			}
			custom_tooltip = {
				text = HAS15SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 15 }
				}
			}
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_summon_lesser_demons_cooldown }
						had_character_flag = { flag = spell_summon_lesser_demons_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_summon_lesser_demons_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			spawn_unit = {
				province = closest_to_capital
				earmark = wiz_lesser_demons
				troops = {
					archers = { 300 300 }
					light_infantry = { 700 700 }
					heavy_infantry = { 100 100 }
				}
				cannot_inherit = yes
				attrition = 0.4
				maintenance_multiplier = 0.1
				can_toggle_looting = no
				reinforces = no
			}
			hidden_tooltip = { character_event = { id = spellaux.19 months = 5 } }
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	
	spell_conjure_elementals = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_modifier = wiz_wild
				has_character_flag = knows_spell_conjure_elementals
			}
			OR = {
				AND = {
					ai = yes
					is_ruler = yes
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			war = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = NOSUMMONEDDEMONS
				hidden_tooltip = {
					NOT = { has_earmarked_regiments = wiz_elementals }
				}
			}
			custom_tooltip = {
				text = HAS12SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 12 }
				}
			}
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_conjure_elementals_cooldown }
						had_character_flag = { flag = spell_conjure_elementals_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_conjure_elementals_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -12 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			spawn_unit = {
				province = closest_to_capital
				earmark = wiz_elementals
				troops = {
					elemental_troops = { 600 600 }
				}
				cannot_inherit = yes
				attrition = 0
				maintenance_multiplier = 0
				can_toggle_looting = no
				reinforces = no
			}
			hidden_tooltip = { character_event = { id = spellaux.40 months = 5 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	greater_planar_binding = {
		ai_check_interval = 24
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_flag = knows_spell_greater_planar_binding
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS20SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 25 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_greater_planar_binding_cooldown }
						had_character_flag = { flag = spell_greater_planar_binding_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_greater_planar_binding_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -25 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			custom_tooltip = {
				text = OUTSIDERSUMMONED
				hidden_tooltip = {
					random_list = {
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_angel
								attributes = {
									diplomacy = 8
									martial = 8
									stewardship = 8
									intrigue = 8
									learning = 8
								}
								random_traits = yes
								religion = good_human_pantheon
								culture = angel
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 300
								female = random
								trait = creature_genie
								attributes = {
									diplomacy = 8
									martial = 8
									stewardship = 8
									intrigue = 8
									learning = 8
								}
								random_traits = yes
								religion = ten_thousand_gods
								culture = jann
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_devil
								attributes = {
									diplomacy = 8
									martial = 8
									stewardship = 8
									intrigue = 8
									learning = 8
								}
								random_traits = yes
								religion = infernal
								culture = baatezu
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_demon
								attributes = {
									diplomacy = 8
									martial = 8
									stewardship = 8
									intrigue = 8
									learning = 8
								}
								random_traits = yes
								religion = abyssal_cult
								culture = tanarri
								dynasty = none
								immortal_age = 30
							}
						}
						1 = {
							create_character = {
								age = 1000
								female = random
								trait = creature_daemon
								attributes = {
									diplomacy = 8
									martial = 8
									stewardship = 8
									intrigue = 8
									learning = 8
								}
								random_traits = yes
								religion = evil_human_pantheon
								culture = yugoloth
								dynasty = none
								immortal_age = 30
							}
						}
					}
					new_character = {
						opinion = {
							modifier = planar_binding_mod
							who = ROOT
							years = 2000
						}
						if = {
							limit = {
								trait = creature_devil
							}
							random_list = {
								65 = {
									set_graphical_culture = cornugon
								}
								20 = {
									add_trait = greater_fiend
								}
								10 = {
									set_graphical_culture = gelugon
									add_trait = greater_fiend
								}
								5 = {
									set_graphical_culture = tiefling
								}
							}
						}
						else_if = {
							limit = {
								trait = creature_demon
							}
							random_list = {
								65 = {
									# do nothing - vrock gfx is correct
								}
								20 = {
									set_graphical_culture = succubus
								}
								10 = {
									set_graphical_culture = nalfeshnee
									add_trait = greater_fiend
								}
								10 = {
									set_graphical_culture = succubus
									add_trait = greater_fiend # marilith
								}						
								2 = {
									set_graphical_culture = baatezu # balors look a lot like pit fiends
									add_trait = greater_fiend
								}
								2 = {
									set_graphical_culture = yugoloth # or nycaloths
									add_trait = greater_fiend
								}
								2 = {
									set_graphical_culture = cambion
								}
							}
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.2
			modifier = {
				factor = 0
				has_full_court = yes
			}
		}
	}
	
	incendiary_cloud = {
		ai_check_interval = 7
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_conjuration
				has_character_flag = knows_spell_incendiary_cloud
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_battle = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS17SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 17 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_incendiary_cloud_cooldown }
						had_character_flag = { flag = spell_incendiary_cloud_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_incendiary_cloud_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -17 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						combat = {
							enemy = {
								ai = no
							}
						}
					}
					combat = {
						enemy = {
							repeat_event = { id = spellaux.30 }
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							damage_unit = { percentage = 0.15 } # Might be too much?
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}

#Divination spells

	detect_thoughts = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_detect_thoughts
			}
			OR = {
				AND = {
					ai = yes
					OR = {
						has_job_title = job_spymaster
						is_ruler = yes
					}
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = detect_thoughts_mod }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_detect_thoughts_cooldown }
						had_character_flag = { flag = spell_detect_thoughts_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_detect_thoughts_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = detect_thoughts_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 0.5
				intrigue = 10 # Don't really need it
			}
			modifier = {
				factor = 5
				NOT = { intrigue = 5 }
			}
		}
	}
	
	comprehend_languages = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_comprehend_languages
			}
			OR = {
				AND = {
					ai = yes
					OR = {
						has_job_title = job_chancellor
						is_ruler = yes
					}
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = comprehend_languages_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_comprehend_languages_cooldown }
						had_character_flag = { flag = spell_comprehend_languages_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_comprehend_languages_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = comprehend_languages_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 0.5
				diplomacy = 10 # Don't really need it
			}
			modifier = {
				factor = 5
				NOT = { diplomacy = 5 }
			}
		}
	}
	
	spell_forget_past_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_forget_past
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	probe_thoughts_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_probe_thoughts
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	legend_lore = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_legend_lore
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = legend_lore_mod }
			custom_tooltip = {
				text = HAS15SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 15 }
				}
			}
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_legend_lore_cooldown }
						had_character_flag = { flag = spell_legend_lore_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_legend_lore_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = legend_lore_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	
	spell_anticipation = {
		ai_check_interval = 12
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_anticipation
			}
			OR = {
				AND = {
					ai = yes
					OR = {
						is_ruler = yes
						has_job_title = job_spymaster
					}
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS20SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 20 }
				}
			}
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_anticipation_cooldown }
						had_character_flag = { flag = spell_anticipation_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_anticipation_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			any_courtier = {
				spell_resistance_check_prev = yes
				reveal_plot = ROOT
				opinion = {
					modifier = cast_spell_on_me
					who = ROOT
					years = 1
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 0
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
		}
	}

#Enchantment spells

	spell_charm_person_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_charm_person
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_rage = {
		ai_check_interval = 6
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_rage
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_command = yes
			NOT = { trait = spell_rage_trait }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_rage_cooldown }
						had_character_flag = { flag = spell_rage_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_rage_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait = spell_rage_trait
			hidden_tooltip = { character_event = { id = spellaux.29 months = 2 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_crown_of_madness_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_crown_of_darkness
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}

	spell_cathalas_compulsion_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_cathalas_compulsion
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	mordekainens_involuntary_wizardry_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_modifier = wiz_wild
				has_character_flag = knows_spell_mordekainens_involuntary_wizardry
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	dominate_person_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_dominate_person
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}

# Evocation spells

	spell_fireball = {
		ai_check_interval = 7
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_evocation
				has_character_modifier = wiz_wild
				has_character_flag = knows_spell_fireball
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_battle = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_fireball_cooldown }
						had_character_flag = { flag = spell_fireball_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_fireball_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						combat = {
							enemy = {
								ai = no
							}
						}
					}
					combat = {
						enemy = {
							repeat_event = { id = spellaux.24 }
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							damage_unit = { percentage = 0.05 }
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_magic_missile_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_magic_missile
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_lightning_bolt = {
		ai_check_interval = 5
		potential = {
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_lightning_bolt
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS15SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 15 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_lightning_bolt_cooldown }
						had_character_flag = { flag = spell_lightning_bolt_cooldown months = 1 }
					}
				}
			}
			in_battle = yes
			enemy = {
				is_alive = yes # Just to make sure that there *is* a leader
			}
		}
		effect = {
			change_variable = { which = wizspellpoints value = -15 }
			set_character_flag = spell_lightning_bolt_cooldown
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			combat = {
				enemy = {
					random_list = {
						10 = {
							modifier = {
								factor = 0
								has_injury_trigger = yes
							}
							set_character_flag = lightning_wound
						}
						5 = {
							modifier = {
								factor = 0
								OR = {
									trait = maimed
									AND = {
										trait = one_eyed
										trait = one_handed 
										trait = one_legged 
										trait = disfigured 
										trait = mangled
									}
								}
							}
							set_character_flag = lightning_maim
						}
						1 = {
							set_character_flag = lightning_death
						}
					}
					repeat_event = { id = spellaux.25 }
				}
			}
			if = {
				limit = {
					combat = {
						enemy = {
							ai = no
						}
					}
				}
				combat = {
					enemy = {
						repeat_event = { id = spellaux.3 }
					}
				}
			}
			combat = {
				enemy = {
					opinion = {
						modifier = cast_spell_on_me
						who = ROOT
						years = 1
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	
	spell_wall_of_stone_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_wall_of_stone
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	chain_lightning = {
		ai_check_interval = 7
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_chain_lightning
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_battle = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS17SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 17 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_chain_lightning_cooldown }
						had_character_flag = { flag = spell_chain_lightning_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_chain_lightning_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -17 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						combat = {
							enemy = {
								ai = no
							}
						}
					}
					combat = {
						enemy = {
							repeat_event = { id = spellaux.31 }
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							damage_unit = { percentage = 0.15 } # Might be too much
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	maddening_darkness = {
		ai_check_interval = 7
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_maddening_darkness
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_battle = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS17SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 17 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_maddening_darkness_cooldown }
						had_character_flag = { flag = spell_maddening_darkness_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_maddening_darkness_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -17 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						combat = {
							enemy = {
								ai = no
							}
						}
					}
					combat = {
						enemy = {
							repeat_event = { id = spellaux.32 }
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							damage_unit_morale = 0.15 # Might be too much
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
#Illusion spells
	
	phantom_steed = {
		ai_check_interval = 5
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_phantom_steed
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			hidden_tooltip = {
				OR = {
					ai = no
					AND = {
						has_character_flag = is_in_duel
						NOT = { had_character_flag = { flag = is_in_duel months = 1 } }
					}
				}
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = phantom_steed_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = phantom_steed_cooldown }
						had_character_flag = { flag = phantom_steed_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = phantom_steed_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = phantom_steed_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}
	
	alustriels_banner = {
		ai_check_interval = 6
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_alustriels_banner
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_command = yes
			NOT = { trait = alustriels_banner_trait }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = HAS5SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 5 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_alustriels_banner_cooldown }
						had_character_flag = { flag = spell_alustriels_banner_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_alustriels_banner_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait = alustriels_banner_trait
			hidden_tooltip = { character_event = { id = spellaux.28 months = 2 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	phantasmal_force = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_phantasmal_force
			}
			OR = {
				AND = {
					ai = yes
					is_ruler = yes
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			war = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = NOSUMMONEDDEMONS
				hidden_tooltip = {
					NOT = { has_earmarked_regiments = wiz_illusions }
				}
			}
			custom_tooltip = {
				text = HAS10SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 10 }
				}
			}
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_phantasmal_force_cooldown }
						had_character_flag = { flag = spell_phantasmal_force_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_phantasmal_force_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			spawn_unit = {
				province = closest_to_capital
				earmark = wiz_illusions
				troops = {
					illusory_troops = { 800 800 }
				}
				cannot_inherit = yes
				attrition = 0
				maintenance_multiplier = 0
				can_toggle_looting = no
				reinforces = no
			}
			hidden_tooltip = { character_event = { id = spellaux.27 months = 5 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	phantasmal_killer_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_phantasmal_killer
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_weird = {
		ai_check_interval = 7
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_weird
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			in_battle = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS17SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 17 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_weird_cooldown }
						had_character_flag = { flag = spell_weird_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_weird_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -17 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						combat = {
							enemy = {
								ai = no
							}
						}
					}
					combat = {
						enemy = {
							repeat_event = { id = spellaux.34 }
						}
					}
				}
				combat = {
					enemy = {
						combat = {
							damage_unit_morale = 0.15 # Might be too much
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_mental_prison_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_mental_prison
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}

#Necromancy spells
	
	spell_animate_dead = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_animate_dead
			}
			OR = {
				AND = {
					ai = yes
					is_ruler = yes
				}
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			war = yes
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = NOSUMMONEDDEMONS
				hidden_tooltip = {
					NOT = { has_earmarked_regiments = wiz_animate_dead }
				}
			}
			custom_tooltip = {
				text = HAS12SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 10 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_animate_dead_cooldown }
						had_character_flag = { flag = spell_animate_dead_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_animate_dead_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			spawn_unit = {
				province = closest_to_capital
				earmark = wiz_animate_dead
				troops = {
					undead_troops = { 500 500 }
				}
				cannot_inherit = yes
				attrition = 0
				maintenance_multiplier = 0
				can_toggle_looting = no
				reinforces = no
			}
			hidden_tooltip = { character_event = { id = spellaux.37 months = 5 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_false_life = {
		ai_check_interval = 10
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_false_life
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			NOT = { has_character_modifier = spell_false_life_mod }
			custom_tooltip = {
				text = HAS7SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 7 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_false_life_cooldown }
						had_character_flag = { flag = spell_false_life_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_false_life_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -7 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_character_modifier = {
				name = spell_false_life_mod
				months = 3
			}
		}
		ai_will_do = {
			factor = 0.4
			modifier = {
				factor = 0.1
				health = 10 # Don't really need it
			}
			modifier = {
				factor = 5
				NOT = { health = 5 }
			}
		}
	}
	
	bestow_curse_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_bestow_curse
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_create_undead = {
		ai_check_interval = 24
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_create_undead
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = JOURNEYMANWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = journeyman_wizard
						trait = expert_wizard
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS20SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 20 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_create_undead_cooldown }
						had_character_flag = { flag = spell_create_undead_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_create_undead_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			custom_tooltip = {
				text = UNDEADSUMMONED
				hidden_tooltip = {
					location = {
						create_character = {
							age = 100
							female = random
							random_traits = yes
							trait = undead
							religion = ROOT
							culture = THIS
							dynasty = none
							immortal_age = 30
						}
					}
					new_character = {
						character_event = { id = z_character_trait.1 }
						opinion = {
							modifier = planar_binding_mod
							who = ROOT
							years = 2000
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.2
			modifier = {
				factor = 0
				has_full_court = yes
			}
		}
	}
	
	spell_blight_fake = { # This is basically a reminder that you have this spell and who you can use it on
		potential = {
			ai = no
			z_wizard = yes
			has_character_flag = wiz_spellbook_open
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_blight
			}
		}
		
		allow = {
			always = no
		}
		
		effect = {
			break = yes # doesn't matter
		}
		
		ai_will_do = {
			factor = 0 # Just to be sure
		}
	}
	
	spell_clone = {
		ai_check_interval = 50
		potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_clone
			}
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			NOR = {
				trait = avatar
				trait = creature_demon
				trait = creature_devil
				trait = creature_daemon
				trait = creature_angel
				trait = creature_genie
			}
		}
		allow = {
			scaled_wealth = { value = 0.1 min = 50 }
			NOT = { has_injury_trigger = yes }
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS30SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 30 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_clone_cooldown }
						had_character_flag = { flag = spell_clone_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			scaled_wealth = { value = -0.1 min = 50 }
			set_character_flag = spell_clone_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -30 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 15
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			add_trait_wounded_effect = yes
			export_to_variable = {
				which = global_clone_health
				value = base_health
			}
			export_to_variable = {
				which = global_clone_fertility
				value = fertility
			}
			export_to_variable = {
				which = global_clone_diplomacy
				value = diplomacy
			}
			export_to_variable = {
				which = global_clone_martial
				value = martial
			}
			export_to_variable = {
				which = global_clone_stewardship
				value =	stewardship
			}
			export_to_variable = {
				which = global_clone_intrigue
				value = intrigue
			}
			export_to_variable = {
				which = global_clone_learning
				value =	learning
			}
			create_character = {
				age = 20
				random_traits = no
				religion = ROOT
				culture = ROOT
				dynasty = ROOT
				attributes = {
					diplomacy = global_clone_diplomacy
					martial = global_clone_martial
					stewardship = global_clone_stewardship
					intrigue = global_clone_intrigue
					learning = global_clone_learning
				}
				dna = ROOT
			}
			new_character = {
				fertility = global_clone_fertility
				health = global_clone_health
				add_trait = is_clone
				if = {
					limit = {
						ROOT = {
							is_female = no
						}
					}
					set_father = ROOT
					set_gender = male
				}
				else_if = {
					limit = {
						ROOT = {
							is_female = yes
						}
					}
					set_mother = ROOT
					set_gender = female
				}
				ROOT = {
					recalc_succession = yes
				}
				copy_traits_of_root = yes
				tb_graph_culture_racial = yes
				any_sibling = {
					limit = {
						trait = is_clone
					}
					add_rival = PREV
				}
			}
		}
		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 5
				any_child = {
					NOT = { is_alive = yes }
				}
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_lichdom = {
		ai_check_interval = 24
		potential = {
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			has_character_modifier = wiz_necromancy
			NOR = {
				trait = creature_treant
				trait = undead
				trait = lich
				trait = vampire
				trait = vampire_spawn
				trait = lich_baelnorn
				trait = creature_monster
				trait = creature_devil
				trait = creature_daemon
				trait = creature_demon
				trait = creature_angel
				trait = creature_genie
				trait = longevity
			}
		}
		
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			scaled_wealth = { value = 0.2 min = 100 }
			custom_tooltip = {
				text = MASTERWIZHIGHER
				hidden_tooltip = {
					OR = {
						trait = master_wizard
						trait = renowned_wizard
						trait = legendary_wizard
					}
				}
			}
			custom_tooltip = {
				text = HAS30SPELLPOINTS
				hidden_tooltip = {
					check_variable = { which = wizspellpoints value = 30 }
				}
			}
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_lichdom_cooldown }
						had_character_flag = { flag = spell_lichdom_cooldown months = 1 }
					}
				}
			}
		}
		
		effect = {
			scaled_wealth = { value = -0.2 min = 100 }
			set_character_flag = spell_lichdom_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -30 } }
			random = {
				chance = 75
				add_trait = lich
				hidden_tooltip = {
					if = {
						limit = {
							trait = creature_human
							trait = creature_aasimar
							trait = creature_tiefling
							trait = creature_half_giant
							trait = creature_genasi
							trait = creature_gith
							trait = creature_gnome
							trait = creature_halfling
							trait = creature_centaur
							trait = creature_wemic
						}
						if = {
							limit = {
								NOR = {
									culture = shou
									culture = khatin
									culture = gugari
									culture = kozakuran
									culture = mulhorandi
									culture = murghomi
								}
							}
							set_graphical_culture = lich
						}
						else_if = {
							limit = {
								OR = {
									culture = shou
									culture = khatin
									culture = gugari
									culture = kozakuran
								}
							}
							set_graphical_culture = undead_shou
						}
						else_if = {
							limit = {
								OR = {
									culture = mulhorandi
									culture = murghomi
								}
							}
							set_graphical_culture = undead_mulhorandi
						}
					}
					else_if = {
						limit = {
							OR = {
								trait = creature_malison
								trait = creature_pureblood
							}
						}
						set_graphical_culture = cambion
					}
					else_if = {
						limit = {
							OR = {
								trait = creature_elf
								trait = creature_eladrin
								trait = creature_feyri
								trait = creature_drow
								trait = creature_half_elf
							}
						}
						set_graphical_culture = undeadelf
					}
					else_if = {
						limit = {
							OR = {
								trait = creature_dwarf
								trait = creature_half_dwarf
							}
						}
						set_graphical_culture = dwarfvampire
					}
					else_if = {
						limit = {
							OR = {
								trait = creature_naga
								trait = creature_abomination
								trait = creature_sarrukh
							}
						}
						set_graphical_culture = bone_naga
					}
					else_if = {
						limit = {
							OR = {
								trait = creature_ogre
								trait = creature_half_ogre
								trait = creature_ogrillon
							}
						}
						set_graphical_culture = undeadogre
					}
				}
			}
		}
		
		ai_will_do = {
			factor = 0.4
		}
	}
	
#Wild Magic spells

	nahals_reckless_dweomer = {
		potential = {
			ai = no # Don't trust the AI to not rapid-fire this
			z_wizard = yes
			OR = {
				ai = yes
				has_character_flag = wiz_spellbook_open
			}
			has_character_modifier = wiz_wild
		}
		allow = {
			NOT = { has_character_modifier = burn_path_mod }
			custom_tooltip = {
				text = SPELL_ON_COOLDOWN
				hidden_tooltip = {
					OR = {
						NOT = { has_character_flag = spell_nahals_reckless_dweomer_cooldown }
						had_character_flag = { flag = spell_nahals_reckless_dweomer_cooldown months = 1 }
					}
				}
			}
		}
		effect = {
			set_character_flag = spell_clone_cooldown
			hidden_tooltip = { change_variable = { which = wizspellpoints value = -30 } }
			hidden_tooltip = {
				if = {
					limit = {
						has_character_modifier = wiz_wild
					}
					random = {
						chance = 65
						character_event = { id = spellaux.4 }
						break = yes
					}
				}
			}
			hidden_tooltip = {
				random_list = {
					10 = {
						change_variable = { which = wizspellpoints value = 5 }
					}
					5 = {
						change_variable = { which = wizspellpoints value = 10 }
					}
					1 = {
						change_variable = { which = wizspellpoints value = 15 }
					}
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}

}

targeted_decisions = {

#Universal spells

	spell_banish = {
		ai_check_interval = 4
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
		}
		
		potential = {
			OR = {
				trait = creature_angel
				trait = creature_demon
				trait = creature_devil
				trait = creature_daemon
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				at_location = ROOT
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_banish_cooldown }
							had_character_flag = { flag = spell_banish_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_banish_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			death = { death_reason = death_banished_spell killer = FROM }
			if = {
				limit = {
					ai = no
				}
				FROM = {
					ROOT = {
						character_event = { id = spellaux.5 }
					}
				}
			}
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.2
		}
	}

#Abjuration spells
	
	spell_remove_disease_character = {
		ai_check_interval = 5
		filter = realm_including_me
		ai_target_filter = realm_including_me
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_remove_disease
			}
		}
		potential = {
			OR = {
				trait = ill
				trait = sickly
				character_disease_trigger = yes
			}
		}
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS10SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 10 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_remove_disease_cooldown }
							had_character_flag = { flag = spell_remove_disease_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_remove_disease_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { character = FROM }
					}
					opinion = {
						modifier = cured_me
						who = FROM
						years = 5
					}
					if = {
						limit = {
							ai = no
						}
						repeat_event = { id = spellaux.7 }
					}
				}
				else_if = {
					limit = {
						ai = no
						character = FROM
					}
					character_event = { id = spellaux.8 }
				}
			}
			custom_tooltip = {
				text = ONEDISEASECURED
				hidden_tooltip = {
					remove_trait = sickly
					if = {
						limit = {
							NOT = { has_dlc = "Reapers" }
						}
						remove_trait = ill
					}
					else_if = {
						limit = {
							has_dlc = "Reapers"
						}
						random_list = {
							40 = {
								modifier = {
									NOT = { trait = flu }
									factor = 0
								}
								remove_trait = flu
							}
							20 = {
								modifier = {
									NOT = { trait = dysentery }
									factor = 0
								}
								remove_trait = dysentery
							}
							10 = {
								modifier = {
									NOT = { trait = rabies }
									factor = 0
								}
								remove_trait = rabies
							}
							20 = {
								modifier = {
									NOT = { trait = has_measles }
									factor = 0
								}
								remove_trait = has_measles
							}
							40 = {
								modifier = {
									NOT = {
										trait = food_poisoning
									}
									factor = 0
								}
								remove_trait = food_poisoning
							}
							20 = {
								modifier = {
									NOT = { trait = gout }
									factor = 0
								}
								remove_trait = gout
							}
							40 = {
								modifier = {
									NOT = { trait = scurvy }
									factor = 0
								}
								remove_trait = scurvy
							}
							20 = {
								modifier = {
									NOT = { trait = lovers_pox }
									factor = 0
								}
								remove_trait = lovers_pox
							}
							5 = {
								modifier = {
									NOT = { trait = cancer }
									factor = 0
								}
								remove_trait = cancer
							}
							10 = {
								modifier = {
									NOT = { trait = pneumonic }
									factor = 0
								}
								remove_trait = pneumonic
							}
							10 = {
								modifier = {
									NOT = { trait = syphilitic }
									factor = 0
								}
								remove_trait = syphilitic
							}
							5 = {
								modifier = {
									NOT = { trait = leper }
									factor = 0
								}
								remove_trait = leper
							}
							10 = {
								modifier = {
									NOT = { trait = has_tuberculosis}
									factor = 0
								}
								remove_trait = has_tuberculosis
							}
							10 = {
								modifier = {
									NOT = { trait = has_aztec_disease}
									factor = 0
								}
								remove_trait = has_aztec_disease
							}
							10 = {
								modifier = {
									NOT = { trait = has_small_pox}
									factor = 0
								}
								remove_trait = has_small_pox
							}
							10 = {
								modifier = {
									NOT = { trait = has_bubonic_plague}
									factor = 0
								}
								remove_trait = has_bubonic_plague
							}
							10 = {
								modifier = {
									NOT = { trait = has_typhus}
									factor = 0
								}
								remove_trait = has_typhus
							}
							10 = {
								modifier = {
									NOT = { trait = has_typhoid_fever}
									factor = 0
								}
								remove_trait = has_typhoid_fever
							}
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 100
				character = ROOT
			}
			modifier = {
				factor = 0
				is_foe = ROOT
			}
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 10
				is_friend = ROOT
			}
			modifier = {
				factor = 10
				opinion = {
					who = ROOT
					value = 50
				}
			}
			modifier = {
				factor = 0.5
				trait = envious
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
			modifier = {
				factor = 0.1
				OR = {
					trait = cruel
					trait = impaler
				}
			}
			modifier = {
				factor = 0.1
				trait = patron_talona
			}
		}
	}
	
	burn_path = {
		ai_check_interval = 4
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_remove_disease
			}
		}
		potential = {
			OR = {
				z_wizard = yes
				z_sorcerer = yes
				z_warlock = yes
				z_bard = yes
			}
		}
		allow = {
			FROM = {
				at_location = ROOT
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS15SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 15 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_burn_path_cooldown }
							had_character_flag = { flag = spell_burn_path_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_burn_path_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			add_character_modifier = {
				name = burn_path_mod
				months = 2
			}
			if = {
				limit = {
					ai = no
				}
				repeat_event = { id = spellaux.12 }
			}
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}

#Transmutation spells
	
	spell_slow = {
		ai_check_interval = 5
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_slow
			}
		}
		
		potential = {
			OR = {
				location = {
					any_character = {
						is_foe = FROM
						in_command = yes
					}
				}
				location = {
					any_neighbor_province = {
						any_character = {
							is_foe = FROM
							in_command = yes
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS5SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 5 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_slow_cooldown }
							had_character_flag = { flag = spell_slow_cooldown months = 1 }
						}
					}
				}
			}
			NOT = { trait = spell_slow_trait }
		}
		
		effect = {
			FROM = { set_character_flag = spell_slow_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			add_trait = spell_slow_trait 
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
			hidden_tooltip = { repeat_event = { id = spellaux.13 } }
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_disintegrate = {
		ai_check_interval = 10
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_disintegration
			}
		}
		potential = {
			at_location = FROM
		}
		allow = {
			FROM = {
				at_location = ROOT
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_disintegrate_cooldown }
							had_character_flag = { flag = spell_disintegrate_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_disintegrate_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			random_list = {
				10 = {
					modifier = {
						factor = 0
						has_injury_trigger = yes
					}
					set_character_flag = disintegrate_wound
				}
				5 = {
					modifier = {
						factor = 0
						OR = {
							trait = maimed
							AND = {
								trait = one_eyed
								trait = one_handed 
								trait = one_legged 
								trait = disfigured 
								trait = mangled
							}
						}
					}
					set_character_flag = disintegrate_maim
				}
				1 = {
					set_character_flag = disintegrate_death
				}
			}
			repeat_event = { id = spellaux.17 }
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}

#Divination spells

	spell_forget_past = { # This will be a player-only spell because the AI can't really deal with the strategy
		filter = all
		ai_target_filter = none # So the AI will never see this
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_forget_past
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = HAS15SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 15 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_forget_past_cooldown }
							had_character_flag = { flag = spell_forget_past_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_forget_past_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			custom_tooltip = {
				text = REMOVEOPINIONS
				hidden_tooltip = {
					remove_friend = FROM
					remove_lover = FROM
					remove_rival = FROM
					remove_all_opinions_to_from = yes
				}
			}
		}
	}
	
	probe_thoughts = { # This will be a player-only spell because the AI can't really deal with the strategy
		filter = all
		ai_target_filter = none # So the AI will never see this
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_divination
				has_character_flag = knows_spell_probe_thoughts
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = HAS15SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 15 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_probe_thoughts_cooldown }
							had_character_flag = { flag = spell_probe_thoughts_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_probe_thoughts_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			reverse_add_favor = FROM
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
	}

#Enchantment spells

	spell_charm_person = { # This will be a player-only spell because the AI can't really deal with the strategy
		filter = all
		ai_target_filter = none # So the AI will never see this
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_charm_person
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS5SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 5 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_charm_person_cooldown }
							had_character_flag = { flag = spell_charm_person_cooldown months = 1 }
						}
					}
				}
			}
			NOT = {
				has_opinion_modifier = {
					who = FROM
					name = charm_person_spell
				}
			}
			NOT = {
				has_opinion_modifier = {
					who = FROM
					name = charm_person_spell_after
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_charm_person_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -5 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			opinion = {
				modifier = charm_person_spell
				who = FROM
				months = 3
			}
			repeat_event = { id = spellaux.2 days = 90 }
		}
	}
	
	spell_crown_of_madness = {
		ai_check_interval = 30
		filter = rivals
		ai_target_filter = rivals
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_crown_of_madness
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			NOT = { trait = lunatic }
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_crown_of_madness_cooldown }
							had_character_flag = { flag = spell_crown_of_madness_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_crown_of_madness_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			repeat_event = { id = spellaux.20 }
			repeat_event = { id = spellaux.21 days = 90 }
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 0.1
				FROM = { trait = kind }
			}
			modifier = {
				factor = 5
				FROM = { trait = cruel }
			}
		}
	}
	
	spell_cathalas_compulsion = {
		ai_check_interval = 30
		filter = rivals
		ai_target_filter = rivals
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_cathalas_compulsion
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			NOT = { is_rival = FROM }
			NOT = { is_friend = FROM }
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS15SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 15 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_cathalas_compulsion_cooldown }
							had_character_flag = { flag = spell_cathalas_compulsion_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_cathalas_compulsion_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			add_rival = FROM
		}
		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 0
				FROM = {
					opinion = {
						who = ROOT
						value >= 25
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = { trait = kind }
			}
			modifier = {
				factor = 5
				FROM = { trait = cruel }
			}
		}
	}
	
	mordekainens_involuntary_wizardry = {
		ai_check_interval = 30
		filter = rivals
		ai_target_filter = rivals
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_modifier = wiz_wild
				has_character_flag = knows_spell_mordekainens_involuntary_wizardry
			}
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_mordekainens_involuntary_wizardry_cooldown }
							had_character_flag = { flag = spell_mordekainens_involuntary_wizardry_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_mordekainens_involuntary_wizardry_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			character_event = { id = spellaux.22 }
		}
		ai_will_do = {
			factor = 0.1
			modifier = {
				factor = 0
				FROM = {
					opinion = {
						who = ROOT
						value >= 25
					}
				}
			}
			modifier = {
				factor = 5
				is_rival = FROM
			}
			modifier = {
				factor = 0.1
				FROM = { trait = kind }
			}
			modifier = {
				factor = 5
				FROM = { trait = cruel }
			}
		}
	}
	
	dominate_person = {
		ai_check_interval = 12
		filter = sub_realm
		ai_target_filter = sub_realm
		
		from_potential = {
			is_landed = yes
			is_inaccessible_or_incapable_trigger = no
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_enchantment
				has_character_flag = knows_spell_dominate_person
			}
		}
		potential = {
			is_adult = yes
			ai = yes
			OR = {
				host = { character = FROM }
				liege = { character = FROM }
			}
		}
		allow = {
			NOR = {
				trait = creature_illithid
				trait = creature_yikarian
			}
			NOT = {
				has_opinion_modifier = { who = FROM modifier = mind_control }
			}
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_dominate_person_cooldown }
							had_character_flag = { flag = spell_dominate_person_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_dominate_person_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			opinion = {
				modifier = mind_control who = FROM years = 2
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}

# Evocation spells
	
	spell_magic_missile = {
		ai_check_interval = 10
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_magic_missile
			}
		}
		potential = {
			at_location = FROM
		}
		allow = {
			FROM = {
				at_location = ROOT
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS10SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 10 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_magic_missile_cooldown }
							had_character_flag = { flag = spell_magic_missile_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_magic_missile_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			random_list = {
				10 = {
					modifier = {
						factor = 0
						has_injury_trigger = yes
					}
					set_character_flag = magicmissile_wound
				}
				1 = {
					modifier = {
						factor = 0
						OR = {
							trait = maimed
							AND = {
								trait = one_eyed
								trait = one_handed 
								trait = one_legged 
								trait = disfigured 
								trait = mangled
							}
						}
					}
					set_character_flag = magicmissile_maim
				}
			}
			repeat_event = { id = spellaux.23 }
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.5
		}
	}

#Illusion spells

	phantasmal_killer = {
		ai_check_interval = 5
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_phantsmal_killer
			}
		}
		
		potential = {
			OR = {
				location = {
					any_character = {
						is_foe = FROM
						in_command = yes
					}
				}
				location = {
					any_neighbor_province = {
						any_character = {
							is_foe = FROM
							in_command = yes
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS12SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 12 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_phantasmal_killer_cooldown }
							had_character_flag = { flag = spell_phantasmal_killer_cooldown months = 1 }
						}
					}
				}
			}
			NOT = { has_character_modifier = phantasmal_killer_mod }
		}
		
		effect = {
			FROM = { set_character_flag = spell_phantasmal_killer_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -12 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			add_character_modifier = {
				name = phantasmal_killer_mod
				months = 2
			}
			hidden_tooltip = { repeat_event = { id = spellaux.33 } }
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}
	
	spell_mental_prison = {
		ai_check_interval = 30
		filter = rivals
		ai_target_filter = rivals
		only_playable = yes
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_illusion
				has_character_flag = knows_spell_mental_prison
			}
			ai = no
		}
		
		potential = {
			ai = yes
			OR = {
				is_ruler = yes
				same_realm = FROM
			}
		}
		
		allow = {
			NOT = { is_incapable = yes }
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS25SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 25 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_mental_prison_cooldown }
							had_character_flag = { flag = spell_mental_prison_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_mental_prison_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -25 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			repeat_event = { id = spellaux.35 }
			repeat_event = { id = spellaux.36 days = 90 }
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 0.1
				FROM = { trait = kind }
			}
			modifier = {
				factor = 5
				FROM = { trait = cruel }
			}
		}
	}

#Necromancy spells

	bestow_curse = {
		ai_check_interval = 5
		filter = rivals
		ai_target_filter = rivals
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_bestow_curse
			}
		}
		
		potential = {
			OR = {
				location = {
					any_character = {
						is_foe = FROM
					}
				}
				location = {
					any_neighbor_province = {
						any_character = {
							is_foe = FROM
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				NOT = { has_character_modifier = bestow_curse_mod }
				NOT = { has_character_modifier = burn_path_mod }
				NOT = { is_foe = ROOT }
				custom_tooltip = {
					text = HAS15SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 15 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_bestow_curse_cooldown }
							had_character_flag = { flag = spell_bestow_curse_cooldown months = 1 }
						}
					}
				}
			}
		}
		
		effect = {
			FROM = { set_character_flag = spell_bestow_curse_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -15 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			spell_resistance_check = yes
			repeat_event = { id = spellaux.38 }
			opinion = {
				modifier = cast_spell_on_me
				who = FROM
				years = 1
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 0.5
				trait = slothful
			}
		}
	}

}

settlement_decisions = {

#Abjuration spells
	
	spell_remove_disease_prov = {
		ai_check_interval = 5
		filter = realm_owned
		ai_target_filter = realm_owned
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_abjuration
				has_character_flag = knows_spell_remove_disease
			}
		}
		potential = {
			location = { has_disease = yes }
		}
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS10SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 10 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_remove_disease_cooldown }
							had_character_flag = { flag = spell_remove_disease_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_remove_disease_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			random_list = {
				1 = {
					location = {
						reduce_disease = 1.0 # *should* remove it completely
					}
					hidden_tooltip = {
						if = {
							limit = {
								location = {
									holder_scope = {
										NOT = { character = FROM }
									}
								}
							}
							location = {
								holder_scope = {
									opinion = {
										modifier = cured_my_lands
										who = FROM
										years = 5
									}
									if = {
										limit = {
											ai = no
										}
										repeat_event = { id = spellaux.9 }
									}
								}
							}
						}
						else_if = {
							limit = {
								location = {
									holder_scope = {
										ai = no
										character = FROM
									}
								}
							}
							location = {
								FROM = { character_event = { id = spellaux.10 } }
							}
						}
					}
				}
				1 = {
					FROM = {
						if = {
							limit = {
								ai = no
							}
							character_event = { id = spellaux.11 }
						}
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 100
				location = {
					holder_scope = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				location = {
					holder_scope = {
						is_foe = FROM
					}
				}
			}
			modifier = {
				factor = 10
				FROM = { trait = kind }
			}
			modifier = {
				factor = 10
				location = {
					holder_scope = {
						is_friend = FROM
					}
				}
			}
			modifier = {
				factor = 10
				location = {
					holder_scope = {
						opinion = {
							who = FROM
							value = 50
						}
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = { trait = envious }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = slothful }
			}
			modifier = {
				factor = 0.1
				FROM = {
					OR = {
						trait = cruel
						trait = impaler
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = { trait = patron_talona }
			}
		}
	}
	
	spell_fabricate = {
		ai_check_interval = 24
		filter = realm_owned
		ai_target_filter = realm_owned
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_transmutation
				has_character_flag = knows_spell_fabricate
			}
		}
		potential = {
			location = {
				holder_scope = {
					character = FROM
				}
			}
		}
		allow = {
			location = {
				NOT = { has_province_modifier = spell_fabricate_mod }
			}
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS10SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 10 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_fabricate_cooldown }
							had_character_flag = { flag = spell_fabricate_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_fabricate_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			location = {
				add_province_modifier = {
					name = spell_fabricate_mod
					months = 2
				}
			}
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 0
				FROM = { NOT = { wealth = 100 } }
			}
			modifier = {
				factor = 10
				FROM = { trait = diligent }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = slothful }
			}
			modifier = {
				factor = 20
				FROM = { trait = patron_gond }
			}
		}
	}

	spell_wall_of_stone = {
		ai_check_interval = 24
		filter = realm_owned
		ai_target_filter = realm_owned
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_evocation
				has_character_flag = knows_spell_wall_of_stone
			}
		}
		potential = {
			location = {
				holder_scope = {
					character = FROM
				}
			}
		}
		allow = {
			location = {
				has_siege = yes
				NOT = { has_province_modifier = spell_wall_of_stone_mod }
			}
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS10SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 10 }
					}
				}
				custom_tooltip = {
					text = JOURNEYMANWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = journeyman_wizard
							trait = expert_wizard
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_wall_of_stone_cooldown }
							had_character_flag = { flag = spell_wall_of_stone_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_wall_of_stone_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -10 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			location = {
				add_province_modifier = {
					name = spell_wall_of_stone_mod
					months = 4
				}
			}
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 10
				FROM = { trait = diligent }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = slothful }
			}
		}
	}
	
	spell_animate_dead_prov = {
		ai_check_interval = 10
		filter = realm_owned
		ai_target_filter = realm_owned
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_animate_dead
			}
		}
		potential = {
			location = {
				holder_scope = {
					character = FROM
				}
			}
		}
		allow = {
			location = {
				NOT = { has_province_modifier = empty_graves_mod }
			}
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS12SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 12 }
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_animate_dead_cooldown }
							had_character_flag = { flag = spell_animate_dead_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_animate_dead_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -12 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			location = {
				FROM = {
					spawn_unit = {
						province = PREV
						home = PREV
						owner = FROM
						troops = {
							undead_troops = { 100 100 }
						}
						scaled_by_biggest_garrison = 1
						cannot_inherit = yes
						attrition = 0.1
						can_toggle_looting = no
						reinforces = no
					}
				}
			}
			location = {
				add_province_modifier = {
					name = empty_graves_mod
					years = 3
				}
				if = {
					limit = {
						NOT = { 
							has_province_modifier = undead_province
						}
					}
					add_province_modifier = {
						name = raised_dead_in_prov
						years = 3
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.5
			modifier = {
				factor = 0
				FROM = { NOT = { wealth = 100 } }
			}
			modifier = {
				factor = 10
				FROM = { trait = diligent }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = slothful }
			}
			modifier = {
				factor = 20
				FROM = { trait = patron_velsharoon }
			}
			modifier = {
				factor = 20
				FROM = { 
					OR = {
						trait = undead
						trait = vampire
						trait = vampire_spawn
						trait = lich
					}
				}
			}
		}
	}
	
	spell_blight = {
		ai_check_interval = 5
		filter = all
		ai_target_filter = all # I really hope this doesn't mess it up
		
		from_potential = {
			z_wizard = yes
			OR = {
				has_character_modifier = wiz_necromancy
				has_character_flag = knows_spell_blight
			}
		}
		potential = {
			location = { NOT = { has_disease = yes } }
			location = { holder_scope = { is_foe = FROM } }
			OR = {
				location = {
					FROM = {
						at_location = PREV
					}
				}
				location = {
					any_neighbor_province = {
						holder_scope = { same_realm = FROM }
					}
				}
			}
		}
		allow = {
			FROM = {
				NOT = { has_character_modifier = burn_path_mod }
				custom_tooltip = {
					text = HAS20SPELLPOINTS
					hidden_tooltip = {
						check_variable = { which = wizspellpoints value = 20 }
					}
				}
				custom_tooltip = {
					text = MASTERWIZHIGHER
					hidden_tooltip = {
						OR = {
							trait = master_wizard
							trait = renowned_wizard
							trait = legendary_wizard
						}
					}
				}
				custom_tooltip = {
					text = SPELL_ON_COOLDOWN
					hidden_tooltip = {
						OR = {
							NOT = { has_character_flag = spell_blight_cooldown }
							had_character_flag = { flag = spell_blight_cooldown months = 1 }
						}
					}
				}
			}
		}
		effect = {
			FROM = { set_character_flag = spell_blight_cooldown }
			FROM = { hidden_tooltip = { change_variable = { which = wizspellpoints value = -20 } } }
			hidden_tooltip = {
				FROM = {
					if = {
						limit = {
							has_character_modifier = wiz_wild
						}
						random = {
							chance = 15
							character_event = { id = spellaux.4 }
							break = yes
						}
					}
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						location = {
							holder_scope = {
								ai = no
							}
						}
					}
					location = {
						holder_scope = {
							opinion = {
								modifier = cast_spell_on_me
								who = FROM
								years = 1
							}
							repeat_event = { id = spellaux.39 }
						}
					}
				}
			}
			location = {
				random_list = {
					1 = {
						spawn_disease = tuberculosis
					}
					1 = {
						spawn_disease = typhoid_fever
					}
					1 = {
						spawn_disease = typhus
					}
					1 = {
						spawn_disease = measles
					}
					1 = {
						spawn_disease = small_pox
					}
					1 = {
						spawn_disease = syphilis
					}
				}
			}
		}
		ai_will_do = {
			factor = 0.3
			modifier = {
				factor = 10
				location = {
					holder_scope = {
						is_foe = FROM
					}
				}
			}
			modifier = {
				factor = 0.1
				FROM = { trait = kind }
			}
			modifier = {
				factor = 0
				location = {
					holder_scope = {
						is_friend = FROM
					}
				}
			}
			modifier = {
				factor = 10
				location = {
					holder_scope = {
						opinion = {
							who = FROM
							value = 50
						}
					}
				}
			}
			modifier = {
				factor = 2
				FROM = { trait = envious }
			}
			modifier = {
				factor = 0.5
				FROM = { trait = slothful }
			}
			modifier = {
				factor = 10
				FROM = {
					OR = {
						trait = cruel
						trait = impaler
					}
				}
			}
			modifier = {
				factor = 20
				FROM = { trait = patron_talona }
			}
		}
	}
	
}